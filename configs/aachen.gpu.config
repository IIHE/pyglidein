[Mode]
debug = False

[Glidein]
site = aachen
address = http://glidein-simprod.icecube.wisc.edu:11001/jsonrpc
# How long to wait before considering the next set of jobs, if client.py should be run by cron use -1
delay = 600

# Location of the tarball, etc.
loc = /home/ac_icecube/pyglidein
# Filename of tarball to be extracted
# should be found by default
# tarball = glidein.tar.gz

[Cluster]
# Scheduler used by cluster
scheduler = LSF

# User under which the jobs are being submitted
user = reimann
os = RHEL7 

submit_command = bsub <
# Command needed to determine the number of jobs running
running_cmd = bjobs -w | grep "IceCube.GPU.PyGlidein" | wc -l
idle_cmd = bjobs -w | grep "IceCube.GPU.PyGlidein" | grep PEND | wc -l

max_total_jobs = 23
max_idle_jobs = 10
limit_per_submit = 5

walltime_hrs = 6

cvmfs = True
#cpu_only = False
gpu_only = True

# Memory per computing core in MB
#mem_per_core = 2000
#max_disk = 10000

# local queue limits, memory and disk in MB
whole_node = True
whole_node_cpus = 8
whole_node_memory = 20000
whole_node_disk = 100000
whole_node_gpus = 2

prioritize_jobs = ["gpu", "memory", "disk"]

# Group jobs with the same requirements into a
# single submission.
# Special note for PBS:
# The option `group_jobs` cannot be used with PBS.
# gridftp does not like the name of the temporary
# directories generated by PBS. The name has a
# `[]` in it, which gridftp takes offense to.
#groups_jobs = True

[SubmitFile]
# Filename of the submit file
filename = submit.gpu.lsf

# Temporary directory environment variable
local_dir = /work/ac_icecube/IceProd/scratch/${LSB_JOBID}_${LSB_JOBINDEX}

# Extra line(s) in LSF header
# Give job a name so we can find it better in the list of jobs
# add openmp to get jobs with multi-cores running
# seems not to make problems for single core jobs
custom_header = #BSUB -J IceCube.GPU.PyGlidein
    #BSUB -a openmp
    #BSUB -q gpu

# Custom extra line(s) needed for cluster.
custom_middle = module load cuda
    CUDA_VISIBLE_DEVICES=0,1

# Custom extra line(s) needed at the end of the job
# custom_end =

# conversion from KB to MB, because LSF scheduler uses KB values but we need MB as default
mem_scale = 0.001

# GPU Request command
#gpu_submit = #BSUB -q gpu

[CustomEnv]
# Special enviroment variables that need to be set
TMPDIR = /work/ac_icecube/IceProd/scratch/${LSB_JOBID}_${LSB_JOBINDEX} 
GLIDEIN_DIR = /home/ac_icecube/pyglidein
